---
title: "Florida (Non-Spatial Analysis) Results"
output: pdf_document
date: '2022-08-25'
---
## Models 1-3: 77 timepoints

* Model 1: Unconstrained growth; no interventions
* Model 2: Baseline intensity plus linear time component beginning on first intervention date (school closure)
* Model 3: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order)

## Models 4-14: 184 timepoints

* Model 4: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order)
* Model 5: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order) and temporal basis splines of 3 degrees of freedom
* Model 6: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order) and temporal basis splines of 4 degrees of freedom
* Model 7: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order) and temporal basis splines of 5 degrees of freedom
* Model 8: Baseline intensity plus two linear time components, beginning on respective intervention dates (school closure and state mandated stay-at-home-order) and temporal basis splines of 6 degrees of freedom
* Model 9: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order) and one beginning on the end of the stay-at-home order
* Model 10: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order), one beginning on the end of the stay-at-home order and temporal basis splines of 3 degrees of freedom
* Model 11: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order), one beginning on the end of the stay-at-home order and temporal basis splines of 4 degrees of freedom
* Model 12: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order), one beginning on the end of the stay-at-home order and temporal basis splines of 5 degrees of freedom
* Model 13: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order), one beginning on the end of the stay-at-home order and temporal basis splines of 6 degrees of freedom
* Model 14: Baseline intensity plus three linear time components, two beginning on respective intervention dates (school closure and state mandated stay-at-home-order), one beginning on the end of the stay-at-home order and a temporal trigonometric term

## Models 15: 121 timepoints

* Model 15: Baseline intensity, a temporal trigonometric term and proportion of population vaccinated (at least one vaccine shot) and proportion fully vaccinated (all doses prescribed by the initial vaccination protocol)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(ABSEIR)
library(forestmangr)
```

```{r}
load("./fl_results.RData")
```



```{r}
plotPosteriorPredictive_firstwave(simulations1, "Model 1: Posterior Predictive Distribution")
plotPosteriorPredictive_firstwave(result1, "Model 1: Posterior Distribution")
```


```{r}
plotPosteriorPredictive_firstwave(simulations2, "Model 2: Posterior Predictive Distribution")
plotPosteriorPredictive_firstwave(result2, "Model 2: Posterior Distribution")

```

```{r}
plotPosteriorPredictive_firstwave(simulations3, "Model 3: Posterior Predictive Distribution")
plotPosteriorPredictive_firstwave(result3, "Model 3: Posterior Distribution")
```

```{r}
plotPosteriorPredictive_interventions(simulations4, "Model 4: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result4, "Model 4: Posterior Distribution")

# two interventions
```

```{r}
plotPosteriorPredictive_interventions(simulations5, "Model 5: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result5, "Model 5: Posterior Distribution")

# two interventions plus time basis of 3
```

```{r}
plotPosteriorPredictive_interventions(simulations6, "Model 6: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result6, "Model 6: Posterior Distribution")

# two interventions plus time basis of 4
```

```{r}
plotPosteriorPredictive_interventions(simulations7, "Model 7: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result7, "Model 7: Posterior Distribution")

# two interventions plus time basis of 5
```

```{r}
plotPosteriorPredictive_interventions(simulations8, "Model 8: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result8, "Model 8: Posterior Distribution")

# two interventions plus time basis of 6
```

```{r}
plotPosteriorPredictive_interventions(simulations9, "Model 9: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result9, "Model 9: Posterior Distribution")

# two interventions, reopen
```

```{r}
plotPosteriorPredictive_interventions(simulations10, "Model 10: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result10, "Model 10: Posterior Distribution")

# two interventions, reopen and time basis of 3
```

```{r}
plotPosteriorPredictive_interventions(simulations11, "Model 11: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result11, "Model 11: Posterior Distribution")

# two interventions, reopen and time basis of 4
```

```{r}
plotPosteriorPredictive_interventions(simulations12, "Model 12: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result12, "Model 12: Posterior Distribution")

# two interventions, reopen and time basis of 5
```

```{r}
plotPosteriorPredictive_interventions(simulations13, "Model 13: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result13, "Model 13: Posterior Distribution")

# two interventions, reopen and time basis of 6
```

```{r}
plotPosteriorPredictive_interventions(simulations14, "Model 14: Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result14, "Model 14: Posterior Distribution")

# two interventions, reopen and trig temporal term
```

```{r}
plotPosteriorPredictive_interventions(simulations6_weibull, "Model 6 (Weibull Distribution): Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result6_weibull, "Model 6 (Weibull Distribution): Posterior Distribution")

# two interventions and time basis of 4
```

```{r}
plotPosteriorPredictive_interventions(simulations6_exp_basic, "Model 6 (Basic ABC): Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result6_exp_basic, "Model 6 (Basic ABC): Posterior Distribution")

# two interventions and time basis of 4
```

```{r}
plotPosteriorPredictive_interventions(simulations6_weibull_basic, "Model 6 (Weibull, Basic ABC): Posterior Predictive Distribution")
plotPosteriorPredictive_interventions(result6_weibull_basic, "Model 6 (Weibull, Basic ABC): Posterior Distribution")

# two interventions and time basis of 4
```

```{r}
plotPosteriorPredictive_vaccines(simulations15, "Model 15: Posterior Predictive Distribution")
plotPosteriorPredictive_vaccines(result15, "Model 15: Posterior Distribution")

# use vaccines for spatial case only
```

```{r}
beta_idx_m3 <- grepl("Beta_SE", colnames(result3$param.samples)) # use to get beta estimates/samples
eta_m3 <- exposure_model_3$X %*% t(result3$param.samples[,beta_idx_m3]) # get intensity matrix/time series (X(se) x Beta(se))
 
 plot(apply(eta_m3, 1, mean), 
      type = 'l', 
      main = 'Model 3 Intensity Prediction',
      ylab = 'Intensity (Eta)',
      xlab = 'Epidemic Day')
 
 # drives the I_star compartment
```

```{r}

beta_idx_m6 <- grepl("Beta_SE", colnames(result6$param.samples)) # use to get beta estimates/samples
eta_m6 <- exposure_model_6$X %*% t(result6$param.samples[,beta_idx_m6]) # get intensity matrix/time series (X(se) x Beta(se))
 
 plot(apply(eta_m6, 1, mean), 
      type = 'l', 
      main = 'Model 6 Intensity Prediction',
      ylab = 'Intensity (Eta)',
      xlab = 'Epidemic Day')
 
 # drives the I_star compartment
```

```{r}

beta_idx_m11 <- grepl("Beta_SE", colnames(result11$param.samples)) # use to get beta estimates/samples
eta_m11 <- exposure_model_11$X %*% t(result11$param.samples[,beta_idx_m11]) # get intensity matrix/time series (X(se) x Beta(se))
 
 plot(apply(eta_m11, 1, mean), 
      type = 'l', 
      main = 'Model 11 Intensity Prediction',
      ylab = 'Intensity (Eta)',
      xlab = 'Epidemic Day')
 
 # drives the I_star compartment
```

# Model 1

```{r}
summary(result1)
```

# Model 2

```{r}
summary(result2)
```

# Model 3

```{r}
summary(result3)
```

# Model 4

```{r}
summary(result4)
```

# Model 5

```{r}
summary(result5)
```

# Model 6 (SMC-ABC, Exponential Distribution)

```{r}
summary(result6)
```

# Model 6 (SMC-ABC, Weibull Distribution)

```{r}
summary(result6_weibull)
```

# Model 6 (Basic ABC, Weibull Distribution)

```{r}
summary(result6_weibull_basic)
```

# Model 6 (Basic ABC, Exponential Distribution)

```{r}
summary(result6_exp_basic)
```

# Model 7

```{r}
summary(result7)
```

# Model 8

```{r}
summary(result8)
```

# Model 9

```{r}
summary(result9)
```

# Model 10

```{r}
summary(result10)
```

# Model 11

```{r}
summary(result11)
```

# Model 12

```{r}
summary(result12)
```

# Model 13

```{r}
summary(result13)
```

# Model 14

```{r}
summary(result14)
```

# Model 15

```{r}
summary(result15)
```

# Bayes Factor (Model 2 vs Model 3)

```{r}
compareModels(list(result2, result3), n_samples = 1000, 
              batch_size = 2000)

# splines approach allows us to construct fexible models in the absence of structural information about the pandemic which would otherwise help inform the intensity process, such as finer spatiotemporal indexing (ie. between counties) and comprehensive data on public health efforts, among other things.....especially with florida as they never had any state mandated mask wearing protocols but this doesnt mean individuals didnt take part in mask wearing (which reduces exposure)

# If these (current eps) are dramatically different, this approach may produce misleading results.

```

# Bayes Factor (Comparison Between Models 4-8)

```{r}
compareModels(list(result4, result5, result6, result7, result8), n_samples = 1000, 
              batch_size = 2000)

# model 6 best
```

# Bayes Factor (Comparison Between Models 9-14)

```{r}
compareModels(list(result9, result10, result11, result12, result13, result14), n_samples = 1000, 
              batch_size = 2000)

# model 11 best
```

# Bayes Factor (Model 6 vs Model 11)

```{r}
compareModels(list(result6, result11), n_samples = 1000, 
              batch_size = 2000)

# If these (current eps) are dramatically different, this approach may produce misleading results.
```

# Bayes Factor (Model 6: Exponential Distribution vs Weibull Distribution)

```{r}
compareModels(list(result6, result6_weibull), n_samples = 1000, 
              batch_size = 2000)

# weibull better
```

# Coverage, width and bias for model 6 with exponential distribution, SMC-ABC (latent and infectious period estimates)

```{r}
get_coverage_ei(simulations6, exp_transition_priors$p_ei) # underestimates latent period (minuscule)
```

```{r}
get_coverage_ir(simulations6, exp_transition_priors$p_ir)  # increased bias magnitude due to less confidence in terms of prior infectious period...slightly overestimates infectious period
```

# Coverage, width and bias for model 6 with exponential distribution, basic ABC (latent and infectious period estimates)

```{r}
get_coverage_ei(simulations6_exp_basic, exp_transition_priors$p_ei) # underestimates latent period (minuscule)
```

```{r}
get_coverage_ir(simulations6_exp_basic, exp_transition_priors$p_ir)  # increased bias magnitude due to less confidence in terms of prior infectious period...slightly overestimates infectious period
```

# Coverage, width and bias for model 11 (latent and infectious period estimates)

```{r}
get_coverage_ei(simulations11, exp_transition_priors$p_ei) # underestimates latent period (minuscule)
```

```{r}
get_coverage_ir(simulations11, exp_transition_priors$p_ir) # overestimates infectious period.....increased positive bias
```

# Coverage, width and bias for model 6 with weibull distribution, SMC-ABC (latent and infectious period estimates (shape and scale))

```{r}
get_coverage_weibull(simulations6_weibull,weibull_alpha_latent,"latent_shape")
```

```{r}
get_coverage_weibull(simulations6_weibull,weibull_beta_latent,"latent_scale")
```

```{r}
get_coverage_weibull(simulations6_weibull,weibull_alpha_infectious,"infectious_shape")
```

```{r}
get_coverage_weibull(simulations6_weibull,weibull_beta_infectious,"infectious_scale")
```

# Coverage, width and bias for model 6 with weibull distribution, Basic ABC (latent and infectious period estimates (shape and scale))

```{r}
get_coverage_weibull(simulations6_weibull_basic,weibull_alpha_latent,"latent_shape")
```

```{r}
get_coverage_weibull(simulations6_weibull_basic,weibull_beta_latent,"latent_scale")
```

```{r}
get_coverage_weibull(simulations6_weibull_basic,weibull_alpha_infectious,"infectious_shape")
```

```{r}
get_coverage_weibull(simulations6_weibull_basic,weibull_beta_infectious,"infectious_scale")
```

# Runtimes

```{r}
timeMatrix = rbind(runtime1,runtime2, runtime3, runtime4, runtime5, runtime6, runtime7, runtime8, runtime9, runtime10, runtime11,
                   runtime12, runtime13, runtime14, runtime15, runtime6_weibull, runtime6_exp_basic, runtime6_weibull_basic)
rownames(timeMatrix) = paste("model", 1:18)
print(timeMatrix[,1:3])
# use in table with number of parameters and also number of timepoints
```

